{"ast":null,"code":"import _regeneratorRuntime from \"D:\\\\socialNetwork\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";\nimport _asyncToGenerator from \"D:\\\\socialNetwork\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";\nimport _toConsumableArray from \"D:\\\\socialNetwork\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/toConsumableArray\";\nimport _objectSpread from \"D:\\\\socialNetwork\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/objectSpread2\";\nimport { followAPI, userAPI } from \"../api/api\";\nimport { updateObjectArray } from \"../utils/objectsHelpers\";\nvar FOLLOW = \"FOLLOW\";\nvar UNFOLLOW = \"UNFOLLOW\";\nvar SET_USERS = 'SET-USERS';\nvar SET_CURRENT_PAGE = 'SET-CURRENT-PAGE';\nvar SET_TOTAL_USERS_COUNT = 'SET-TOTAL-USERS-COUNT';\nvar ON_NUMBER_CHANGE = 'ON-NUMBER-CHANGE';\nvar SEARCH_NUMBER = 'SEARCH-NUMBER';\nvar TOGGLE_IS_FETCHING = 'TOGGLE-IS-FETCHING';\nvar TOGGLE_IS_FETCHING_PROGRESS = 'TOGGLE-IS-FETCHING-PROGRESS';\nvar initialState = {\n  users: [\n    /*\r\n    {\r\n        id: 1,\r\n        ava: 'http://zhaba.ru/storage-10667/images-4356/7da28183c1ca335727f6033007c24c3f_74356.gif',\r\n        followed: true,\r\n        fullName: 'Andry',\r\n        status: 'Сижу кушаю',\r\n        location: {city: 'Dnipro', country: 'Ukraine'}\r\n    },\r\n    {\r\n        id: 2,\r\n        ava: 'http://zhaba.ru/storage-10667/images-4356/2ec52d3e31cc84526b5c1b8d332bb5f2_74356.gif',\r\n        followed: false,\r\n        fullName: 'Viktoriya',\r\n        status: 'на море',\r\n        location: {city: 'Poltava', country: 'Ukraine'}\r\n    },\r\n    {\r\n        id: 3,\r\n        ava: 'http://zhaba.ru/storage-10667/images-4356/54c86b4b33e968bb15eeea983d72a850_74356.gif',\r\n        followed: true,\r\n        fullName: 'Natalia',\r\n        status: 'в астрале',\r\n        location: {city: 'Dnipro', country: 'Ukraine'}\r\n    },\r\n    {\r\n        id: 4,\r\n        ava: 'http://zhaba.ru/storage-10667/images-4356/05f88dffdf9a406fe9b0bee9df3160a5_74356.gif',\r\n        followed: false,\r\n        fullName: 'Dmitry',\r\n        status: 'я Сенсей',\r\n        location: {city: 'Minsk', country: 'Belarus'}\r\n    },\r\n    */\n  ],\n  pageSize: 5,\n  totalUsersCount: 0,\n  currentPage: 1,\n  numberChange: '',\n  isFetching: false,\n  followingInProgress: []\n};\nexport var usersReducer = function usersReducer() {\n  var state = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : initialState;\n  var action = arguments.length > 1 ? arguments[1] : undefined;\n\n  switch (action.type) {\n    case FOLLOW:\n      return _objectSpread(_objectSpread({}, state), {}, {\n        users: updateObjectArray(state.users, action.userId, 'id', {\n          followed: true\n        })\n        /*users: state.users.map(u => {\r\n            if (u.id === action.userId) {\r\n                return {...u, followed: true}\r\n            }\r\n            return u;\r\n        })*/\n\n      });\n\n    case UNFOLLOW:\n      return _objectSpread(_objectSpread({}, state), {}, {\n        users: updateObjectArray(state.users, action.userId, 'id', {\n          followed: false\n        })\n        /*users: state.users.map(u => {\r\n            if (u.id === action.userId) {\r\n                return {...u, followed: false}\r\n            }\r\n            return u;\r\n        })*/\n\n      });\n\n    case SET_USERS:\n      {\n        return _objectSpread(_objectSpread({}, state), {}, {\n          users: _toConsumableArray(action.users)\n        });\n      }\n\n    case SET_CURRENT_PAGE:\n      {\n        return _objectSpread(_objectSpread({}, state), {}, {\n          currentPage: action.currentPage\n        });\n      }\n\n    case SET_TOTAL_USERS_COUNT:\n      {\n        return _objectSpread(_objectSpread({}, state), {}, {\n          totalUsersCount: action.totalCount\n        });\n      }\n\n    case ON_NUMBER_CHANGE:\n      {\n        return _objectSpread(_objectSpread({}, state), {}, {\n          numberChange: action.number\n        });\n      }\n\n    case SEARCH_NUMBER:\n      {\n        if (state.numberChange >= 1 && state.numberChange <= state.totalUsersCount / state.pageSize) {\n          return _objectSpread(_objectSpread({}, state), {}, {\n            currentPage: state.numberChange\n          });\n        } else {\n          return _objectSpread(_objectSpread({}, state), {}, {\n            currentPage: 1\n          });\n        }\n      }\n\n    case TOGGLE_IS_FETCHING:\n      {\n        {\n          return _objectSpread(_objectSpread({}, state), {}, {\n            isFetching: action.isFetching\n          });\n        }\n      }\n\n    case TOGGLE_IS_FETCHING_PROGRESS:\n      {\n        {\n          return _objectSpread(_objectSpread({}, state), {}, {\n            followingInProgress: action.isFetching ? [].concat(_toConsumableArray(state.followingInProgress), [action.userId]) : state.followingInProgress.filter(function (id) {\n              return id != action.userId;\n            })\n          });\n        }\n      }\n\n    default:\n      return state;\n  } //return state;\n\n};\nexport var follow = function follow(userId) {\n  return {\n    type: FOLLOW,\n    userId\n  };\n};\nexport var unFollow = function unFollow(userId) {\n  return {\n    type: UNFOLLOW,\n    userId\n  };\n};\nexport var setUsers = function setUsers(users) {\n  return {\n    type: SET_USERS,\n    users\n  };\n};\nexport var setCurrentPage = function setCurrentPage(currentPage) {\n  return {\n    type: SET_CURRENT_PAGE,\n    currentPage\n  };\n};\nexport var setTotalUsersCount = function setTotalUsersCount(totalCount) {\n  return {\n    type: SET_TOTAL_USERS_COUNT,\n    totalCount\n  };\n};\nexport var onNumberChange = function onNumberChange(number) {\n  return {\n    type: ON_NUMBER_CHANGE,\n    number\n  };\n};\nexport var searchNumber = function searchNumber() {\n  return {\n    type: SEARCH_NUMBER\n  };\n};\nexport var toggleIsFetching = function toggleIsFetching(isFetching) {\n  return {\n    type: TOGGLE_IS_FETCHING,\n    isFetching\n  };\n};\nexport var toggleIsFetchingProgress = function toggleIsFetchingProgress(isFetching, userId) {\n  return {\n    type: TOGGLE_IS_FETCHING_PROGRESS,\n    isFetching,\n    userId\n  };\n};\nexport var requestUsers = function requestUsers(currentPage, pageSize) {\n  return /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(dispatch) {\n      var data;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              dispatch(toggleIsFetching(true));\n              _context.next = 3;\n              return userAPI.getUsers(currentPage, pageSize);\n\n            case 3:\n              data = _context.sent;\n              dispatch(toggleIsFetching(false));\n              dispatch(setUsers(data.items));\n              dispatch(setTotalUsersCount(data.totalCount));\n\n            case 7:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function (_x) {\n      return _ref.apply(this, arguments);\n    };\n  }();\n};\n\nvar followUnFollowFlow = /*#__PURE__*/function () {\n  var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(dispatch, id, apiMethod, actionCreator) {\n    var data;\n    return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            dispatch(toggleIsFetchingProgress(true, id));\n            _context2.next = 3;\n            return apiMethod(id);\n\n          case 3:\n            data = _context2.sent;\n\n            if (data.resultCode == 0) {\n              dispatch(actionCreator(id));\n            }\n\n            dispatch(toggleIsFetchingProgress(false, id));\n\n          case 6:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, _callee2);\n  }));\n\n  return function followUnFollowFlow(_x2, _x3, _x4, _x5) {\n    return _ref2.apply(this, arguments);\n  };\n}();\n\nexport var deleteUser = function deleteUser(id) {\n  return /*#__PURE__*/function () {\n    var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(dispatch) {\n      var apiMethod, actionCreator;\n      return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              apiMethod = followAPI.deleteUser.bind(id);\n              actionCreator = unFollow;\n              followUnFollowFlow(dispatch, id, apiMethod, actionCreator);\n\n            case 3:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3);\n    }));\n\n    return function (_x6) {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n};\nexport var postUser = function postUser(id) {\n  return /*#__PURE__*/function () {\n    var _ref4 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4(dispatch) {\n      var apiMethod, actionCreator;\n      return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n        while (1) {\n          switch (_context4.prev = _context4.next) {\n            case 0:\n              apiMethod = followAPI.postUser.bind(id);\n              actionCreator = follow;\n              followUnFollowFlow(dispatch, id, apiMethod, actionCreator);\n\n            case 3:\n            case \"end\":\n              return _context4.stop();\n          }\n        }\n      }, _callee4);\n    }));\n\n    return function (_x7) {\n      return _ref4.apply(this, arguments);\n    };\n  }();\n  /*return async (dispatch) => {\r\n      dispatch(toggleIsFetchingProgress(true, id));\r\n      let data = await followAPI.postUser(id);\r\n      if (data.resultCode == 0) {\r\n          dispatch(follow(id))\r\n      }\r\n      dispatch(toggleIsFetchingProgress(false, id));\r\n  }*/\n};","map":{"version":3,"sources":["D:/socialNetwork/src/redux/usersReducer.js"],"names":["followAPI","userAPI","updateObjectArray","FOLLOW","UNFOLLOW","SET_USERS","SET_CURRENT_PAGE","SET_TOTAL_USERS_COUNT","ON_NUMBER_CHANGE","SEARCH_NUMBER","TOGGLE_IS_FETCHING","TOGGLE_IS_FETCHING_PROGRESS","initialState","users","pageSize","totalUsersCount","currentPage","numberChange","isFetching","followingInProgress","usersReducer","state","action","type","userId","followed","totalCount","number","filter","id","follow","unFollow","setUsers","setCurrentPage","setTotalUsersCount","onNumberChange","searchNumber","toggleIsFetching","toggleIsFetchingProgress","requestUsers","dispatch","getUsers","data","items","followUnFollowFlow","apiMethod","actionCreator","resultCode","deleteUser","bind","postUser"],"mappings":"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","sourcesContent":["import {followAPI, userAPI} from \"../api/api\";\r\nimport {updateObjectArray} from \"../utils/objectsHelpers\";\r\n\r\nconst FOLLOW = \"FOLLOW\";\r\nconst UNFOLLOW = \"UNFOLLOW\";\r\nconst SET_USERS = 'SET-USERS';\r\nconst SET_CURRENT_PAGE = 'SET-CURRENT-PAGE';\r\nconst SET_TOTAL_USERS_COUNT = 'SET-TOTAL-USERS-COUNT';\r\nconst ON_NUMBER_CHANGE = 'ON-NUMBER-CHANGE';\r\nconst SEARCH_NUMBER = 'SEARCH-NUMBER';\r\nconst TOGGLE_IS_FETCHING = 'TOGGLE-IS-FETCHING';\r\nconst TOGGLE_IS_FETCHING_PROGRESS = 'TOGGLE-IS-FETCHING-PROGRESS';\r\nlet initialState = {\r\n    users: [\r\n        /*\r\n        {\r\n            id: 1,\r\n            ava: 'http://zhaba.ru/storage-10667/images-4356/7da28183c1ca335727f6033007c24c3f_74356.gif',\r\n            followed: true,\r\n            fullName: 'Andry',\r\n            status: 'Сижу кушаю',\r\n            location: {city: 'Dnipro', country: 'Ukraine'}\r\n        },\r\n        {\r\n            id: 2,\r\n            ava: 'http://zhaba.ru/storage-10667/images-4356/2ec52d3e31cc84526b5c1b8d332bb5f2_74356.gif',\r\n            followed: false,\r\n            fullName: 'Viktoriya',\r\n            status: 'на море',\r\n            location: {city: 'Poltava', country: 'Ukraine'}\r\n        },\r\n        {\r\n            id: 3,\r\n            ava: 'http://zhaba.ru/storage-10667/images-4356/54c86b4b33e968bb15eeea983d72a850_74356.gif',\r\n            followed: true,\r\n            fullName: 'Natalia',\r\n            status: 'в астрале',\r\n            location: {city: 'Dnipro', country: 'Ukraine'}\r\n        },\r\n        {\r\n            id: 4,\r\n            ava: 'http://zhaba.ru/storage-10667/images-4356/05f88dffdf9a406fe9b0bee9df3160a5_74356.gif',\r\n            followed: false,\r\n            fullName: 'Dmitry',\r\n            status: 'я Сенсей',\r\n            location: {city: 'Minsk', country: 'Belarus'}\r\n        },\r\n    */\r\n    ],\r\n    pageSize: 5,\r\n    totalUsersCount: 0,\r\n    currentPage: 1,\r\n    numberChange: '',\r\n    isFetching: false,\r\n    followingInProgress: [],\r\n};\r\n\r\nexport const usersReducer = (state = initialState, action) => {\r\n    switch (action.type) {\r\n        case FOLLOW:\r\n            return {\r\n                ...state,\r\n                users: updateObjectArray(state.users,action.userId,'id', {followed: true})\r\n                /*users: state.users.map(u => {\r\n                    if (u.id === action.userId) {\r\n                        return {...u, followed: true}\r\n                    }\r\n                    return u;\r\n                })*/\r\n            }\r\n        case UNFOLLOW:\r\n            return {\r\n                ...state,\r\n                users: updateObjectArray(state.users,action.userId,'id', {followed: false})\r\n                /*users: state.users.map(u => {\r\n                    if (u.id === action.userId) {\r\n                        return {...u, followed: false}\r\n                    }\r\n                    return u;\r\n                })*/\r\n            }\r\n        case SET_USERS: {\r\n            return {\r\n                ...state, users: [...action.users]\r\n            }\r\n        }\r\n        case SET_CURRENT_PAGE: {\r\n            return {...state, currentPage: action.currentPage}\r\n        }\r\n        case SET_TOTAL_USERS_COUNT: {\r\n            return {...state, totalUsersCount: action.totalCount}\r\n        }\r\n        case ON_NUMBER_CHANGE: {\r\n            return {...state, numberChange: action.number}\r\n        }\r\n        case SEARCH_NUMBER: {\r\n            if (state.numberChange >= 1 && state.numberChange <= state.totalUsersCount / state.pageSize) {\r\n                return {...state, currentPage: state.numberChange}\r\n            } else {\r\n                return {...state, currentPage: 1}\r\n            }\r\n        }\r\n        case TOGGLE_IS_FETCHING: {\r\n            {\r\n                return {...state, isFetching: action.isFetching}\r\n            }\r\n        }\r\n        case TOGGLE_IS_FETCHING_PROGRESS: {\r\n            {\r\n                return {\r\n                    ...state,\r\n                    followingInProgress: action.isFetching\r\n                        ? [...state.followingInProgress, action.userId]\r\n                        : state.followingInProgress.filter(id => id != action.userId)\r\n                }\r\n            }\r\n        }\r\n        default:\r\n            return state;\r\n    }\r\n    //return state;\r\n}\r\nexport const follow = (userId) => {\r\n    return {\r\n        type: FOLLOW,\r\n        userId,\r\n    }\r\n}\r\nexport const unFollow = (userId) => {\r\n    return {\r\n        type: UNFOLLOW,\r\n        userId,\r\n    }\r\n}\r\nexport const setUsers = (users) => {\r\n    return {type: SET_USERS, users}\r\n};\r\nexport const setCurrentPage = (currentPage) => {\r\n    return {type: SET_CURRENT_PAGE, currentPage}\r\n};\r\nexport const setTotalUsersCount = (totalCount) => {\r\n    return {type: SET_TOTAL_USERS_COUNT, totalCount}\r\n};\r\nexport const onNumberChange = (number) => {\r\n    return {type: ON_NUMBER_CHANGE, number}\r\n};\r\nexport const searchNumber = () => {\r\n    return {type: SEARCH_NUMBER}\r\n};\r\nexport const toggleIsFetching = (isFetching) => {\r\n    return {type: TOGGLE_IS_FETCHING, isFetching}\r\n};\r\nexport const toggleIsFetchingProgress = (isFetching, userId) => {\r\n    return {type: TOGGLE_IS_FETCHING_PROGRESS, isFetching, userId}\r\n}\r\nexport const requestUsers = (currentPage, pageSize) => {\r\n    return async (dispatch) => {\r\n        dispatch(toggleIsFetching(true));\r\n        let data = await userAPI.getUsers(currentPage, pageSize);\r\n        dispatch(toggleIsFetching(false));\r\n        dispatch(setUsers(data.items));\r\n        dispatch(setTotalUsersCount(data.totalCount));\r\n    }\r\n}\r\n\r\nconst followUnFollowFlow = async (dispatch, id, apiMethod, actionCreator) => {\r\n    dispatch(toggleIsFetchingProgress(true, id));\r\n    let data = await apiMethod(id);\r\n    if (data.resultCode == 0) {\r\n        dispatch(actionCreator(id))\r\n    }\r\n    dispatch(toggleIsFetchingProgress(false, id));\r\n}\r\n\r\nexport const deleteUser = (id) => {\r\n    return async (dispatch) => {\r\n        let apiMethod = followAPI.deleteUser.bind(id)\r\n        let actionCreator = unFollow;\r\n        followUnFollowFlow(dispatch, id, apiMethod, actionCreator);\r\n    }\r\n}\r\nexport const postUser = (id) => {\r\n    return async (dispatch) => {\r\n        let apiMethod = followAPI.postUser.bind(id)\r\n        let actionCreator = follow;\r\n        followUnFollowFlow(dispatch, id, apiMethod, actionCreator);\r\n    }\r\n    /*return async (dispatch) => {\r\n        dispatch(toggleIsFetchingProgress(true, id));\r\n        let data = await followAPI.postUser(id);\r\n        if (data.resultCode == 0) {\r\n            dispatch(follow(id))\r\n        }\r\n        dispatch(toggleIsFetchingProgress(false, id));\r\n    }*/\r\n}\r\n"]},"metadata":{},"sourceType":"module"}